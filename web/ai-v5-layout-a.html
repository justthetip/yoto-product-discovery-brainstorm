<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Search V5: Layout A - Conversational Inline - Yoto</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#f45436">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f6f7;
            min-height: 100vh;
            padding: 0;
        }

        .design-label {
            position: fixed;
            top: 16px;
            right: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            z-index: 1000;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .chat-header {
            padding: 20px 24px;
            border-bottom: 2px solid #f45436;
            background: white;
            flex-shrink: 0;
        }

        .chat-header h1 {
            font-size: 24px;
            color: #1a1a1a;
            margin-bottom: 4px;
            font-weight: 700;
        }

        .chat-header p {
            font-size: 14px;
            color: #888;
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e8e8e8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #f45436;
        }

        .message-content-wrapper {
            flex: 1;
            max-width: 85%;
        }

        .message-content {
            background: #f5f5f5;
            padding: 14px 18px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.6;
            color: #1a1a1a;
        }

        .message.user .message-content {
            background: #f45436;
            color: white;
        }

        /* Inline product cards */
        .product-recommendations {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .inline-product-card {
            background: white;
            border: 2px solid #e8e8e8;
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            gap: 16px;
        }

        .inline-product-card:hover {
            border-color: #f45436;
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(244, 84, 54, 0.15);
        }

        .product-image-wrapper {
            width: 100px;
            height: 100px;
            border-radius: 12px;
            overflow: hidden;
            background: #f5f5f5;
            flex-shrink: 0;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .product-title {
            font-size: 15px;
            font-weight: 600;
            color: #1a1a1a;
            line-height: 1.3;
        }

        .product-author {
            font-size: 13px;
            color: #888;
        }

        .product-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: auto;
        }

        .product-tag {
            background: #f5f5f5;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            color: #666;
            font-weight: 500;
        }

        .product-tag.price {
            background: #f45436;
            color: white;
        }

        .product-reasoning {
            background: #fff8f6;
            border-left: 3px solid #f45436;
            padding: 12px 14px;
            margin-top: 8px;
            border-radius: 8px;
            font-size: 13px;
            color: #666;
            line-height: 1.5;
            font-style: italic;
        }

        .recommendation-header {
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .chat-input-area {
            padding: 20px 24px;
            border-top: 1px solid #e8e8e8;
            background: #fafafa;
            flex-shrink: 0;
        }

        .quick-prompts {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .quick-prompt {
            background: white;
            border: 2px solid #e8e8e8;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-prompt:hover {
            background: #f45436;
            color: white;
            border-color: #f45436;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #e8e8e8;
            border-radius: 24px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
            font-family: inherit;
        }

        .chat-input:focus {
            border-color: #f45436;
        }

        .send-button {
            background: #f45436;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 24px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .send-button:hover:not(:disabled) {
            background: #FF5525;
            transform: scale(1.02);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 18px;
            background: #f5f5f5;
            border-radius: 18px;
            font-size: 14px;
            color: #666;
        }

        .loading-dots {
            display: flex;
            gap: 4px;
        }

        .loading-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #f45436;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #ccc;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            color: #888;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .empty-state p {
            font-size: 14px;
            color: #aaa;
        }

        .relevance-score {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
        }

        /* Debug Panel Styles */
        .debug-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            max-height: 500px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            z-index: 1000;
        }

        .debug-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .debug-header:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
        }

        .debug-header h4 {
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .debug-toggle {
            font-size: 12px;
            opacity: 0.9;
        }

        .debug-content {
            padding: 16px;
            font-size: 12px;
            line-height: 1.6;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .debug-content.open {
            display: block;
        }

        .debug-section {
            margin-bottom: 16px;
        }

        .debug-section:last-child {
            margin-bottom: 0;
        }

        .debug-section h5 {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .debug-info {
            background: #f8f9fa;
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .debug-info-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid #f1f3f5;
        }

        .debug-info-row:last-child {
            border-bottom: none;
        }

        .debug-label {
            font-weight: 600;
            color: #6c757d;
        }

        .debug-value {
            color: #212529;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
        }

        .debug-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-right: 6px;
            margin-bottom: 4px;
        }

        .debug-example {
            background: white;
            padding: 8px 10px;
            border-radius: 4px;
            border-left: 3px solid #667eea;
            margin-bottom: 8px;
            font-size: 11px;
        }

        .debug-example:last-child {
            margin-bottom: 0;
        }

        .debug-example-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 4px;
        }

        .debug-example-meta {
            color: #6c757d;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="design-label">Layout A: Conversational</div>

    <div class="chat-container">
        <div class="chat-header">
            <h1>ü§ñ AI Shopping Assistant</h1>
            <p>Products appear naturally in our conversation</p>
        </div>

        <div class="messages-area" id="chatMessages">
            <div class="message assistant">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content-wrapper">
                    <div class="message-content">
                        Hi! I'm your Yoto shopping assistant. I'll help you find the perfect audio content for children. Just tell me what you're looking for, and I'll show you recommendations right here in our chat!
                        <br><br>
                        Try asking me something like:
                        <br>
                        ‚Ä¢ "Find bedtime stories for my 4-year-old"<br>
                        ‚Ä¢ "Educational content about space"<br>
                        ‚Ä¢ "Adventure stories with animals"
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input-area">
            <div class="quick-prompts" id="quickPrompts">
                <button class="quick-prompt" data-prompt="Find calming bedtime stories for a 3-year-old">üåô Bedtime Stories</button>
                <button class="quick-prompt" data-prompt="Show me educational content about dinosaurs">ü¶ï Dinosaurs</button>
                <button class="quick-prompt" data-prompt="Adventure stories under 30 minutes">‚ö° Quick Adventures</button>
                <button class="quick-prompt" data-prompt="Music for toddlers">üéµ Music</button>
            </div>
            <div class="input-wrapper">
                <input
                    type="text"
                    class="chat-input"
                    id="chatInput"
                    placeholder="What are you looking for?"
                    autocomplete="off"
                >
                <button class="send-button" id="sendButton">Send</button>
            </div>
        </div>
    </div>

    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel" style="display: none;">
        <div class="debug-header" id="debugHeader">
            <h4>üîç Search Debug Info</h4>
            <span class="debug-toggle">‚ñº Click to expand</span>
        </div>
        <div class="debug-content" id="debugContent">
            <div class="debug-section">
                <h5>üéØ Extracted Filters</h5>
                <div class="debug-info" id="debugFilters">
                    <div class="debug-info-row">
                        <span class="debug-label">No search yet</span>
                    </div>
                </div>
            </div>
            <div class="debug-section">
                <h5>üìä Filter Results</h5>
                <div class="debug-info" id="debugResults">
                    <div class="debug-info-row">
                        <span class="debug-label">No results yet</span>
                    </div>
                </div>
            </div>
            <div class="debug-section">
                <h5>üìù Example Matches</h5>
                <div id="debugExamples">
                    <div class="debug-info-row">
                        <span class="debug-label">No examples yet</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Modify the existing layout6-ai-chat.js functionality to render inline
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const quickPrompts = document.querySelectorAll('.quick-prompt');

        // Override the renderProducts function to show inline cards
        window.renderProductsInline = function(products) {
            const wrapper = document.createElement('div');
            wrapper.className = 'product-recommendations';

            const header = document.createElement('div');
            header.className = 'recommendation-header';
            header.textContent = `‚ú® Here are ${products.length} recommendations:`;
            wrapper.appendChild(header);

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'inline-product-card';

                card.innerHTML = `
                    <div class="product-image-wrapper">
                        <img src="${product.imageUrl || 'https://via.placeholder.com/100'}" alt="${product.title}" class="product-image">
                    </div>
                    <div class="product-details">
                        <div class="product-title">${product.title}</div>
                        <div class="product-author">${product.author || 'Yoto'}</div>
                        <div class="product-tags">
                            <span class="product-tag price">${product.price}</span>
                            ${product.ageRange ? `<span class="product-tag">Ages ${product.ageRange}</span>` : ''}
                            ${product.runtime ? `<span class="product-tag">${product.runtime}</span>` : ''}
                        </div>
                    </div>
                `;

                if (product.reasoning) {
                    const reasoning = document.createElement('div');
                    reasoning.className = 'product-reasoning';
                    reasoning.textContent = product.reasoning;
                    card.appendChild(reasoning);
                }

                wrapper.appendChild(card);
            });

            return wrapper;
        };
    </script>
    <script src="/web/layout6-ai-chat.js"></script>
    <script>
        // Wait for chat to initialize, then override displayProducts
        document.addEventListener('DOMContentLoaded', () => {
            // Override displayProducts method after chat is initialized
            if (window.yotoChat) {
                setupCustomDisplay();
            } else {
                // Wait for yotoChat to be available
                const checkChat = setInterval(() => {
                    if (window.yotoChat) {
                        clearInterval(checkChat);
                        setupCustomDisplay();
                    }
                }, 100);
            }
        });

        function setupCustomDisplay() {
            window.yotoChat.displayProducts = function(rankedProducts) {
                const chatMessages = document.getElementById('chatMessages');

                // Get full product details
                const productsWithDetails = rankedProducts.map(rp => {
                    const product = this.products.find(p => p.id === rp.id);
                    return {
                        ...product,
                        relevanceScore: rp.relevanceScore,
                        reasoning: rp.reasoning
                    };
                }).filter(p => p.id);

                // Sort by relevance
                productsWithDetails.sort((a, b) => (b.relevanceScore || 0) - (a.relevanceScore || 0));

                // Create assistant message with inline products
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message assistant';

                const avatar = document.createElement('div');
                avatar.className = 'message-avatar';
                avatar.textContent = 'ü§ñ';

                const contentWrapper = document.createElement('div');
                contentWrapper.className = 'message-content-wrapper';

                const content = document.createElement('div');
                content.className = 'message-content';
                content.textContent = `I found ${productsWithDetails.length} great options for you!`;

                contentWrapper.appendChild(content);

                if (productsWithDetails.length > 0) {
                    const productsEl = renderProductsInline(productsWithDetails);
                    contentWrapper.appendChild(productsEl);
                }

                messageDiv.appendChild(avatar);
                messageDiv.appendChild(contentWrapper);

                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            };
        }

        function renderProductsInline(products) {
            const wrapper = document.createElement('div');
            wrapper.className = 'product-recommendations';

            const header = document.createElement('div');
            header.className = 'recommendation-header';
            header.textContent = `‚ú® Here are ${products.length} recommendations:`;
            wrapper.appendChild(header);

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'inline-product-card';

                const imageUrl = product.images?.[0]?.url || product.imgSet?.sm?.src || '';
                const runtime = product.runtime ? formatRuntime(product.runtime) : '';
                const ageRange = product.ageRange ? `Ages ${product.ageRange[0]}-${product.ageRange[1]}` : '';

                card.innerHTML = `
                    <div class="product-image-wrapper">
                        ${imageUrl ? `<img src="${imageUrl}" alt="${product.title}" class="product-image">` : '<div class="product-image" style="background: #f5f5f5;"></div>'}
                    </div>
                    <div class="product-details">
                        <div class="product-title">${product.title}</div>
                        <div class="product-author">${product.author || 'Yoto'}</div>
                        <div class="product-tags">
                            <span class="product-tag price">¬£${product.price}</span>
                            ${ageRange ? `<span class="product-tag">${ageRange}</span>` : ''}
                            ${runtime ? `<span class="product-tag">${runtime}</span>` : ''}
                        </div>
                    </div>
                `;

                if (product.reasoning) {
                    const reasoning = document.createElement('div');
                    reasoning.className = 'product-reasoning';
                    reasoning.textContent = product.reasoning;
                    card.appendChild(reasoning);
                }

                wrapper.appendChild(card);
            });

            return wrapper;
        }

        function formatRuntime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else {
                return `${minutes}m`;
            }
        }
    </script>
</body>
</html>
